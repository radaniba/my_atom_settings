Object.defineProperty(exports, '__esModule', {
  value: true
});

var _atom = require('atom');

var _helpers = require('./helpers');

var VALID_SEVERITY = new Set(['error', 'warning', 'info']);

function validateUI(ui) {
  var messages = [];

  if (ui && typeof ui === 'object') {
    if (typeof ui.name !== 'string') {
      messages.push('UI.name must be a string');
    }
    if (typeof ui.didBeginLinting !== 'function') {
      messages.push('UI.didBeginLinting must be a function');
    }
    if (typeof ui.didFinishLinting !== 'function') {
      messages.push('UI.didFinishLinting must be a function');
    }
    if (typeof ui.render !== 'function') {
      messages.push('UI.render must be a function');
    }
    if (typeof ui.dispose !== 'function') {
      messages.push('UI.dispose must be a function');
    }
  } else {
    messages.push('UI must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid UI received', 'These issues were encountered while registering the UI named \'' + (ui && ui.name ? ui.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateLinter(linter, version) {
  var messages = [];

  if (linter && typeof linter === 'object') {
    if (typeof linter.name !== 'string') {
      messages.push('Linter.name must be a string');
    }
    if (typeof linter.scope !== 'string' || linter.scope !== 'file' && linter.scope !== 'project') {
      messages.push("Linter.scope must be either 'file' or 'project'");
    }
    if (version === 1 && typeof linter.lintOnFly !== 'boolean') {
      messages.push('Linter.lintOnFly must be a boolean');
    } else if (version === 2 && typeof linter.lintsOnChange !== 'boolean') {
      messages.push('Linter.lintsOnChange must be a boolean');
    }
    if (!Array.isArray(linter.grammarScopes)) {
      messages.push('Linter.grammarScopes must be an Array');
    }
    if (typeof linter.lint !== 'function') {
      messages.push('Linter.lint must be a function');
    }
  } else {
    messages.push('Linter must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Linter received', 'These issues were encountered while registering a Linter named \'' + (linter && linter.name ? linter.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateIndie(indie) {
  var messages = [];

  if (indie && typeof indie === 'object') {
    if (typeof indie.name !== 'string') {
      messages.push('Indie.name must be a string');
    }
  } else {
    messages.push('Indie must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Indie received', 'These issues were encountered while registering an Indie Linter named \'' + (indie && indie.name ? indie.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateMessages(linterName, entries) {
  var messages = [];

  if (Array.isArray(entries)) {
    var invalidURL = false;
    var invalidIcon = false;
    var invalidExcerpt = false;
    var invalidLocation = false;
    var invalidSeverity = false;
    var invalidSolution = false;
    var invalidReference = false;
    var invalidDescription = false;

    for (var i = 0, _length = entries.length; i < _length; ++i) {
      var message = entries[i];
      var reference = message.reference;
      if (!invalidIcon && message.icon && typeof message.icon !== 'string') {
        invalidIcon = true;
        messages.push('Message.icon must be a string');
      }
      if (!invalidLocation && (!message.location || typeof message.location !== 'object' || typeof message.location.file !== 'string' || typeof message.location.position !== 'object' || !message.location.position)) {
        invalidLocation = true;
        messages.push('Message.location must be valid');
      } else if (!invalidLocation) {
        var range = _atom.Range.fromObject(message.location.position);
        if (Number.isNaN(range.start.row) || Number.isNaN(range.start.column) || Number.isNaN(range.end.row) || Number.isNaN(range.end.column)) {
          invalidLocation = true;
          messages.push('Message.location.position should not contain NaN coordinates');
        }
      }
      if (!invalidSolution && message.solutions && !Array.isArray(message.solutions)) {
        invalidSolution = true;
        messages.push('Message.solutions must be valid');
      }
      if (!invalidReference && reference && (typeof reference !== 'object' || typeof reference.file !== 'string' || typeof reference.position !== 'object' || !reference.position)) {
        invalidReference = true;
        messages.push('Message.reference must be valid');
      } else if (!invalidReference && reference) {
        var position = _atom.Point.fromObject(reference.position);
        if (Number.isNaN(position.row) || Number.isNaN(position.column)) {
          invalidReference = true;
          messages.push('Message.reference.position should not contain NaN coordinates');
        }
      }
      if (!invalidExcerpt && typeof message.excerpt !== 'string') {
        invalidExcerpt = true;
        messages.push('Message.excerpt must be a string');
      }
      if (!invalidSeverity && !VALID_SEVERITY.has(message.severity)) {
        invalidSeverity = true;
        messages.push("Message.severity must be 'error', 'warning' or 'info'");
      }
      if (!invalidURL && message.url && typeof message.url !== 'string') {
        invalidURL = true;
        messages.push('Message.url must a string');
      }
      if (!invalidDescription && message.description && typeof message.description !== 'function' && typeof message.description !== 'string') {
        invalidDescription = true;
        messages.push('Message.description must be a function or string');
      }
    }
  } else {
    messages.push('Linter Result must be an Array');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Linter Result received', 'These issues were encountered while processing messages from a linter named \'' + linterName + '\'', messages);
    return false;
  }

  return true;
}

function validateMessagesLegacy(linterName, entries) {
  var messages = [];

  if (Array.isArray(entries)) {
    var invalidFix = false;
    var invalidType = false;
    var invalidClass = false;
    var invalidRange = false;
    var invalidTrace = false;
    var invalidContent = false;
    var invalidFilePath = false;
    var invalidSeverity = false;

    for (var i = 0, _length2 = entries.length; i < _length2; ++i) {
      var message = entries[i];
      if (!invalidType && typeof message.type !== 'string') {
        invalidType = true;
        messages.push('Message.type must be a string');
      }
      if (!invalidContent && (typeof message.text !== 'string' && typeof message.html !== 'string' && !(message.html instanceof HTMLElement) || !message.text && !message.html)) {
        invalidContent = true;
        messages.push('Message.text or Message.html must have a valid value');
      }
      if (!invalidFilePath && message.filePath && typeof message.filePath !== 'string') {
        invalidFilePath = true;
        messages.push('Message.filePath must be a string');
      }
      if (!invalidRange && message.range && typeof message.range !== 'object') {
        invalidRange = true;
        messages.push('Message.range must be an object');
      } else if (!invalidRange && message.range) {
        var range = _atom.Range.fromObject(message.range);
        if (Number.isNaN(range.start.row) || Number.isNaN(range.start.column) || Number.isNaN(range.end.row) || Number.isNaN(range.end.column)) {
          invalidRange = true;
          messages.push('Message.range should not contain NaN coordinates');
        }
      }
      if (!invalidClass && message['class'] && typeof message['class'] !== 'string') {
        invalidClass = true;
        messages.push('Message.class must be a string');
      }
      if (!invalidSeverity && message.severity && !VALID_SEVERITY.has(message.severity)) {
        invalidSeverity = true;
        messages.push("Message.severity must be 'error', 'warning' or 'info'");
      }
      if (!invalidTrace && message.trace && !Array.isArray(message.trace)) {
        invalidTrace = true;
        messages.push('Message.trace must be an Array');
      }
      if (!invalidFix && message.fix && (typeof message.fix.range !== 'object' || typeof message.fix.newText !== 'string' || message.fix.oldText && typeof message.fix.oldText !== 'string')) {
        invalidFix = true;
        messages.push('Message.fix must be valid');
      }
    }
  } else {
    messages.push('Linter Result must be an Array');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Linter Result received', 'These issues were encountered while processing messages from a linter named \'' + linterName + '\'', messages);
    return false;
  }

  return true;
}

exports.ui = validateUI;
exports.linter = validateLinter;
exports.indie = validateIndie;
exports.messages = validateMessages;
exports.messagesLegacy = validateMessagesLegacy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9SYWQvLmF0b20vcGFja2FnZXMvbGludGVyL2xpYi92YWxpZGF0ZS9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O29CQUU2QixNQUFNOzt1QkFDVCxXQUFXOztBQUdyQyxJQUFNLGNBQWMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQTs7QUFFNUQsU0FBUyxVQUFVLENBQUMsRUFBTSxFQUFXO0FBQ25DLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQTs7QUFFbkIsTUFBSSxFQUFFLElBQUksT0FBTyxFQUFFLEtBQUssUUFBUSxFQUFFO0FBQ2hDLFFBQUksT0FBTyxFQUFFLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRTtBQUMvQixjQUFRLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUE7S0FDMUM7QUFDRCxRQUFJLE9BQU8sRUFBRSxDQUFDLGVBQWUsS0FBSyxVQUFVLEVBQUU7QUFDNUMsY0FBUSxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFBO0tBQ3ZEO0FBQ0QsUUFBSSxPQUFPLEVBQUUsQ0FBQyxnQkFBZ0IsS0FBSyxVQUFVLEVBQUU7QUFDN0MsY0FBUSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFBO0tBQ3hEO0FBQ0QsUUFBSSxPQUFPLEVBQUUsQ0FBQyxNQUFNLEtBQUssVUFBVSxFQUFFO0FBQ25DLGNBQVEsQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQTtLQUM5QztBQUNELFFBQUksT0FBTyxFQUFFLENBQUMsT0FBTyxLQUFLLFVBQVUsRUFBRTtBQUNwQyxjQUFRLENBQUMsSUFBSSxDQUFDLCtCQUErQixDQUFDLENBQUE7S0FDL0M7R0FDRixNQUFNO0FBQ0wsWUFBUSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFBO0dBQ3RDOztBQUVELE1BQUksUUFBUSxDQUFDLE1BQU0sRUFBRTtBQUNuQiw0QkFBVSxx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VSxTQUFLLFFBQVEsQ0FBQyxDQUFBO0FBQ3BKLFdBQU8sS0FBSyxDQUFBO0dBQ2I7O0FBRUQsU0FBTyxJQUFJLENBQUE7Q0FDWjs7UUFHZSxFQUFFLEdBQWhCLFVBQVU7UUFDUSxNQUFNLEdBQXhCLGNBQWM7UUFDRyxLQUFLLEdBQXRCLGFBQWE7UUFDTyxRQUFRLEdBQTVCLGdCQUFnQjtRQUNVLGNBQWMsR0FBeEMsc0JBQXNCIiwiZmlsZSI6Ii9Vc2Vycy9SYWQvLmF0b20vcGFja2FnZXMvbGludGVyL2xpYi92YWxpZGF0ZS9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbmltcG9ydCB7IFJhbmdlLCBQb2ludCB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBzaG93RXJyb3IgfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgdHlwZSB7IFVJLCBMaW50ZXIsIE1lc3NhZ2UsIE1lc3NhZ2VMZWdhY3ksIEluZGllIH0gZnJvbSAnLi4vdHlwZXMnXG5cbmNvbnN0IFZBTElEX1NFVkVSSVRZID0gbmV3IFNldChbJ2Vycm9yJywgJ3dhcm5pbmcnLCAnaW5mbyddKVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVVJKHVpOiBVSSk6IGJvb2xlYW4ge1xuICBjb25zdCBtZXNzYWdlcyA9IFtdXG5cbiAgaWYgKHVpICYmIHR5cGVvZiB1aSA9PT0gJ29iamVjdCcpIHtcbiAgICBpZiAodHlwZW9mIHVpLm5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKCdVSS5uYW1lIG11c3QgYmUgYSBzdHJpbmcnKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIHVpLmRpZEJlZ2luTGludGluZyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlkQmVnaW5MaW50aW5nIG11c3QgYmUgYSBmdW5jdGlvbicpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgdWkuZGlkRmluaXNoTGludGluZyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlkRmluaXNoTGludGluZyBtdXN0IGJlIGEgZnVuY3Rpb24nKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIHVpLnJlbmRlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkucmVuZGVyIG11c3QgYmUgYSBmdW5jdGlvbicpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgdWkuZGlzcG9zZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlzcG9zZSBtdXN0IGJlIGEgZnVuY3Rpb24nKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlcy5wdXNoKCdVSSBtdXN0IGJlIGFuIG9iamVjdCcpXG4gIH1cblxuICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgc2hvd0Vycm9yKCdJbnZhbGlkIFVJIHJlY2VpdmVkJywgYFRoZXNlIGlzc3VlcyB3ZXJlIGVuY291bnRlcmVkIHdoaWxlIHJlZ2lzdGVyaW5nIHRoZSBVSSBuYW1lZCAnJHt1aSAmJiB1aS5uYW1lID8gdWkubmFtZSA6ICdVbmtub3duJ30nYCwgbWVzc2FnZXMpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4gdHJ1ZVxufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUxpbnRlcihsaW50ZXI6IExpbnRlciwgdmVyc2lvbjogMSB8IDIpOiBib29sZWFuIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBbXVxuXG4gIGlmIChsaW50ZXIgJiYgdHlwZW9mIGxpbnRlciA9PT0gJ29iamVjdCcpIHtcbiAgICBpZiAodHlwZW9mIGxpbnRlci5uYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnTGludGVyLm5hbWUgbXVzdCBiZSBhIHN0cmluZycpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgbGludGVyLnNjb3BlICE9PSAnc3RyaW5nJyB8fCAobGludGVyLnNjb3BlICE9PSAnZmlsZScgJiYgbGludGVyLnNjb3BlICE9PSAncHJvamVjdCcpKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKFwiTGludGVyLnNjb3BlIG11c3QgYmUgZWl0aGVyICdmaWxlJyBvciAncHJvamVjdCdcIilcbiAgICB9XG4gICAgaWYgKHZlcnNpb24gPT09IDEgJiYgdHlwZW9mIGxpbnRlci5saW50T25GbHkgIT09ICdib29sZWFuJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnTGludGVyLmxpbnRPbkZseSBtdXN0IGJlIGEgYm9vbGVhbicpXG4gICAgfSBlbHNlIGlmICh2ZXJzaW9uID09PSAyICYmIHR5cGVvZiBsaW50ZXIubGludHNPbkNoYW5nZSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKCdMaW50ZXIubGludHNPbkNoYW5nZSBtdXN0IGJlIGEgYm9vbGVhbicpXG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShsaW50ZXIuZ3JhbW1hclNjb3BlcykpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goJ0xpbnRlci5ncmFtbWFyU2NvcGVzIG11c3QgYmUgYW4gQXJyYXknKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIGxpbnRlci5saW50ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKCdMaW50ZXIubGludCBtdXN0IGJlIGEgZnVuY3Rpb24nKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlcy5wdXNoKCdMaW50ZXIgbXVzdCBiZSBhbiBvYmplY3QnKVxuICB9XG5cbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgIHNob3dFcnJvcignSW52YWxpZCBMaW50ZXIgcmVjZWl2ZWQnLCBgVGhlc2UgaXNzdWVzIHdlcmUgZW5jb3VudGVyZWQgd2hpbGUgcmVnaXN0ZXJpbmcgYSBMaW50ZXIgbmFtZWQgJyR7bGludGVyICYmIGxpbnRlci5uYW1lID8gbGludGVyLm5hbWUgOiAnVW5rbm93bid9J2AsIG1lc3NhZ2VzKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVJbmRpZShpbmRpZTogSW5kaWUpOiBib29sZWFuIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBbXVxuXG4gIGlmIChpbmRpZSAmJiB0eXBlb2YgaW5kaWUgPT09ICdvYmplY3QnKSB7XG4gICAgaWYgKHR5cGVvZiBpbmRpZS5uYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnSW5kaWUubmFtZSBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbWVzc2FnZXMucHVzaCgnSW5kaWUgbXVzdCBiZSBhbiBvYmplY3QnKVxuICB9XG5cbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgIHNob3dFcnJvcignSW52YWxpZCBJbmRpZSByZWNlaXZlZCcsIGBUaGVzZSBpc3N1ZXMgd2VyZSBlbmNvdW50ZXJlZCB3aGlsZSByZWdpc3RlcmluZyBhbiBJbmRpZSBMaW50ZXIgbmFtZWQgJyR7aW5kaWUgJiYgaW5kaWUubmFtZSA/IGluZGllLm5hbWUgOiAnVW5rbm93bid9J2AsIG1lc3NhZ2VzKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVNZXNzYWdlcyhsaW50ZXJOYW1lOiBzdHJpbmcsIGVudHJpZXM6IEFycmF5PE1lc3NhZ2U+KTogYm9vbGVhbiB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gW11cblxuICBpZiAoQXJyYXkuaXNBcnJheShlbnRyaWVzKSkge1xuICAgIGxldCBpbnZhbGlkVVJMID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZEljb24gPSBmYWxzZVxuICAgIGxldCBpbnZhbGlkRXhjZXJwdCA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRMb2NhdGlvbiA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRTZXZlcml0eSA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRTb2x1dGlvbiA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRSZWZlcmVuY2UgPSBmYWxzZVxuICAgIGxldCBpbnZhbGlkRGVzY3JpcHRpb24gPSBmYWxzZVxuXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGVudHJpZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlbnRyaWVzW2ldXG4gICAgICBjb25zdCByZWZlcmVuY2UgPSBtZXNzYWdlLnJlZmVyZW5jZVxuICAgICAgaWYgKCFpbnZhbGlkSWNvbiAmJiBtZXNzYWdlLmljb24gJiYgdHlwZW9mIG1lc3NhZ2UuaWNvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW52YWxpZEljb24gPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UuaWNvbiBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZExvY2F0aW9uICYmICghbWVzc2FnZS5sb2NhdGlvbiB8fCB0eXBlb2YgbWVzc2FnZS5sb2NhdGlvbiAhPT0gJ29iamVjdCcgfHwgdHlwZW9mIG1lc3NhZ2UubG9jYXRpb24uZmlsZSAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIG1lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24gIT09ICdvYmplY3QnIHx8ICFtZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uKSkge1xuICAgICAgICBpbnZhbGlkTG9jYXRpb24gPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UubG9jYXRpb24gbXVzdCBiZSB2YWxpZCcpXG4gICAgICB9IGVsc2UgaWYgKCFpbnZhbGlkTG9jYXRpb24pIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSBSYW5nZS5mcm9tT2JqZWN0KG1lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24pXG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocmFuZ2Uuc3RhcnQucm93KSB8fCBOdW1iZXIuaXNOYU4ocmFuZ2Uuc3RhcnQuY29sdW1uKSB8fCBOdW1iZXIuaXNOYU4ocmFuZ2UuZW5kLnJvdykgfHwgTnVtYmVyLmlzTmFOKHJhbmdlLmVuZC5jb2x1bW4pKSB7XG4gICAgICAgICAgaW52YWxpZExvY2F0aW9uID0gdHJ1ZVxuICAgICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24gc2hvdWxkIG5vdCBjb250YWluIE5hTiBjb29yZGluYXRlcycpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZFNvbHV0aW9uICYmIG1lc3NhZ2Uuc29sdXRpb25zICYmICFBcnJheS5pc0FycmF5KG1lc3NhZ2Uuc29sdXRpb25zKSkge1xuICAgICAgICBpbnZhbGlkU29sdXRpb24gPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2Uuc29sdXRpb25zIG11c3QgYmUgdmFsaWQnKVxuICAgICAgfVxuICAgICAgaWYgKCFpbnZhbGlkUmVmZXJlbmNlICYmIHJlZmVyZW5jZSAmJiAodHlwZW9mIHJlZmVyZW5jZSAhPT0gJ29iamVjdCcgfHwgdHlwZW9mIHJlZmVyZW5jZS5maWxlICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgcmVmZXJlbmNlLnBvc2l0aW9uICE9PSAnb2JqZWN0JyB8fCAhcmVmZXJlbmNlLnBvc2l0aW9uKSkge1xuICAgICAgICBpbnZhbGlkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLnJlZmVyZW5jZSBtdXN0IGJlIHZhbGlkJylcbiAgICAgIH0gZWxzZSBpZiAoIWludmFsaWRSZWZlcmVuY2UgJiYgcmVmZXJlbmNlKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gUG9pbnQuZnJvbU9iamVjdChyZWZlcmVuY2UucG9zaXRpb24pXG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocG9zaXRpb24ucm93KSB8fCBOdW1iZXIuaXNOYU4ocG9zaXRpb24uY29sdW1uKSkge1xuICAgICAgICAgIGludmFsaWRSZWZlcmVuY2UgPSB0cnVlXG4gICAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5yZWZlcmVuY2UucG9zaXRpb24gc2hvdWxkIG5vdCBjb250YWluIE5hTiBjb29yZGluYXRlcycpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZEV4Y2VycHQgJiYgdHlwZW9mIG1lc3NhZ2UuZXhjZXJwdCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW52YWxpZEV4Y2VycHQgPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UuZXhjZXJwdCBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZFNldmVyaXR5ICYmICFWQUxJRF9TRVZFUklUWS5oYXMobWVzc2FnZS5zZXZlcml0eSkpIHtcbiAgICAgICAgaW52YWxpZFNldmVyaXR5ID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKFwiTWVzc2FnZS5zZXZlcml0eSBtdXN0IGJlICdlcnJvcicsICd3YXJuaW5nJyBvciAnaW5mbydcIilcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZFVSTCAmJiBtZXNzYWdlLnVybCAmJiB0eXBlb2YgbWVzc2FnZS51cmwgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRVUkwgPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UudXJsIG11c3QgYSBzdHJpbmcnKVxuICAgICAgfVxuICAgICAgaWYgKCFpbnZhbGlkRGVzY3JpcHRpb24gJiYgbWVzc2FnZS5kZXNjcmlwdGlvbiAmJiB0eXBlb2YgbWVzc2FnZS5kZXNjcmlwdGlvbiAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgbWVzc2FnZS5kZXNjcmlwdGlvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW52YWxpZERlc2NyaXB0aW9uID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmRlc2NyaXB0aW9uIG11c3QgYmUgYSBmdW5jdGlvbiBvciBzdHJpbmcnKVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlcy5wdXNoKCdMaW50ZXIgUmVzdWx0IG11c3QgYmUgYW4gQXJyYXknKVxuICB9XG5cbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgIHNob3dFcnJvcignSW52YWxpZCBMaW50ZXIgUmVzdWx0IHJlY2VpdmVkJywgYFRoZXNlIGlzc3VlcyB3ZXJlIGVuY291bnRlcmVkIHdoaWxlIHByb2Nlc3NpbmcgbWVzc2FnZXMgZnJvbSBhIGxpbnRlciBuYW1lZCAnJHtsaW50ZXJOYW1lfSdgLCBtZXNzYWdlcylcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlTWVzc2FnZXNMZWdhY3kobGludGVyTmFtZTogc3RyaW5nLCBlbnRyaWVzOiBBcnJheTxNZXNzYWdlTGVnYWN5Pik6IGJvb2xlYW4ge1xuICBjb25zdCBtZXNzYWdlcyA9IFtdXG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoZW50cmllcykpIHtcbiAgICBsZXQgaW52YWxpZEZpeCA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRUeXBlID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZENsYXNzID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZFJhbmdlID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZFRyYWNlID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZENvbnRlbnQgPSBmYWxzZVxuICAgIGxldCBpbnZhbGlkRmlsZVBhdGggPSBmYWxzZVxuICAgIGxldCBpbnZhbGlkU2V2ZXJpdHkgPSBmYWxzZVxuXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGVudHJpZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlbnRyaWVzW2ldXG4gICAgICBpZiAoIWludmFsaWRUeXBlICYmIHR5cGVvZiBtZXNzYWdlLnR5cGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRUeXBlID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLnR5cGUgbXVzdCBiZSBhIHN0cmluZycpXG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRDb250ZW50ICYmICgodHlwZW9mIG1lc3NhZ2UudGV4dCAhPT0gJ3N0cmluZycgJiYgKHR5cGVvZiBtZXNzYWdlLmh0bWwgIT09ICdzdHJpbmcnICYmICEobWVzc2FnZS5odG1sIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSkgfHwgKCFtZXNzYWdlLnRleHQgJiYgIW1lc3NhZ2UuaHRtbCkpKSB7XG4gICAgICAgIGludmFsaWRDb250ZW50ID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLnRleHQgb3IgTWVzc2FnZS5odG1sIG11c3QgaGF2ZSBhIHZhbGlkIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZEZpbGVQYXRoICYmIG1lc3NhZ2UuZmlsZVBhdGggJiYgdHlwZW9mIG1lc3NhZ2UuZmlsZVBhdGggIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRGaWxlUGF0aCA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5maWxlUGF0aCBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZFJhbmdlICYmIG1lc3NhZ2UucmFuZ2UgJiYgdHlwZW9mIG1lc3NhZ2UucmFuZ2UgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIGludmFsaWRSYW5nZSA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5yYW5nZSBtdXN0IGJlIGFuIG9iamVjdCcpXG4gICAgICB9IGVsc2UgaWYgKCFpbnZhbGlkUmFuZ2UgJiYgbWVzc2FnZS5yYW5nZSkge1xuICAgICAgICBjb25zdCByYW5nZSA9IFJhbmdlLmZyb21PYmplY3QobWVzc2FnZS5yYW5nZSlcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihyYW5nZS5zdGFydC5yb3cpIHx8IE51bWJlci5pc05hTihyYW5nZS5zdGFydC5jb2x1bW4pIHx8IE51bWJlci5pc05hTihyYW5nZS5lbmQucm93KSB8fCBOdW1iZXIuaXNOYU4ocmFuZ2UuZW5kLmNvbHVtbikpIHtcbiAgICAgICAgICBpbnZhbGlkUmFuZ2UgPSB0cnVlXG4gICAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5yYW5nZSBzaG91bGQgbm90IGNvbnRhaW4gTmFOIGNvb3JkaW5hdGVzJylcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFpbnZhbGlkQ2xhc3MgJiYgbWVzc2FnZS5jbGFzcyAmJiB0eXBlb2YgbWVzc2FnZS5jbGFzcyAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW52YWxpZENsYXNzID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmNsYXNzIG11c3QgYmUgYSBzdHJpbmcnKVxuICAgICAgfVxuICAgICAgaWYgKCFpbnZhbGlkU2V2ZXJpdHkgJiYgbWVzc2FnZS5zZXZlcml0eSAmJiAhVkFMSURfU0VWRVJJVFkuaGFzKG1lc3NhZ2Uuc2V2ZXJpdHkpKSB7XG4gICAgICAgIGludmFsaWRTZXZlcml0eSA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaChcIk1lc3NhZ2Uuc2V2ZXJpdHkgbXVzdCBiZSAnZXJyb3InLCAnd2FybmluZycgb3IgJ2luZm8nXCIpXG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRUcmFjZSAmJiBtZXNzYWdlLnRyYWNlICYmICFBcnJheS5pc0FycmF5KG1lc3NhZ2UudHJhY2UpKSB7XG4gICAgICAgIGludmFsaWRUcmFjZSA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS50cmFjZSBtdXN0IGJlIGFuIEFycmF5JylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZEZpeCAmJiBtZXNzYWdlLmZpeCAmJiAodHlwZW9mIG1lc3NhZ2UuZml4LnJhbmdlICE9PSAnb2JqZWN0JyB8fCB0eXBlb2YgbWVzc2FnZS5maXgubmV3VGV4dCAhPT0gJ3N0cmluZycgfHwgKG1lc3NhZ2UuZml4Lm9sZFRleHQgJiYgdHlwZW9mIG1lc3NhZ2UuZml4Lm9sZFRleHQgIT09ICdzdHJpbmcnKSkpIHtcbiAgICAgICAgaW52YWxpZEZpeCA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5maXggbXVzdCBiZSB2YWxpZCcpXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIG1lc3NhZ2VzLnB1c2goJ0xpbnRlciBSZXN1bHQgbXVzdCBiZSBhbiBBcnJheScpXG4gIH1cblxuICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgc2hvd0Vycm9yKCdJbnZhbGlkIExpbnRlciBSZXN1bHQgcmVjZWl2ZWQnLCBgVGhlc2UgaXNzdWVzIHdlcmUgZW5jb3VudGVyZWQgd2hpbGUgcHJvY2Vzc2luZyBtZXNzYWdlcyBmcm9tIGEgbGludGVyIG5hbWVkICcke2xpbnRlck5hbWV9J2AsIG1lc3NhZ2VzKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuZXhwb3J0IHtcbiAgdmFsaWRhdGVVSSBhcyB1aSxcbiAgdmFsaWRhdGVMaW50ZXIgYXMgbGludGVyLFxuICB2YWxpZGF0ZUluZGllIGFzIGluZGllLFxuICB2YWxpZGF0ZU1lc3NhZ2VzIGFzIG1lc3NhZ2VzLFxuICB2YWxpZGF0ZU1lc3NhZ2VzTGVnYWN5IGFzIG1lc3NhZ2VzTGVnYWN5LFxufVxuIl19