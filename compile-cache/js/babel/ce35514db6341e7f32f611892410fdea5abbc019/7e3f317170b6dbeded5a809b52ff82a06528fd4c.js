Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.focusEditor = focusEditor;
exports.replaceTag = replaceTag;
exports.replaceTags = replaceTags;
exports.formatType = formatType;
exports.prepareType = prepareType;
exports.prepareInlineDocs = prepareInlineDocs;
exports.buildDisplayText = buildDisplayText;
exports.buildSnippet = buildSnippet;
exports.extractParams = extractParams;
exports.formatTypeCompletion = formatTypeCompletion;
exports.disposeAll = disposeAll;
exports.openFileAndGoToPosition = openFileAndGoToPosition;
exports.openFileAndGoTo = openFileAndGoTo;
exports.updateTernFile = updateTernFile;
exports.writeFile = writeFile;
exports.isDirectory = isDirectory;
exports.fileExists = fileExists;
exports.getFileContent = getFileContent;
exports.readFile = readFile;
exports.setMarkerCheckpoint = setMarkerCheckpoint;
exports.markerCheckpointBack = markerCheckpointBack;
exports.markDefinitionBufferRange = markDefinitionBufferRange;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _atomTernjsManager = require('./atom-ternjs-manager');

var _atomTernjsManager2 = _interopRequireDefault(_atomTernjsManager);

var _atomTernjsPackageConfig = require('./atom-ternjs-package-config');

var _atomTernjsPackageConfig2 = _interopRequireDefault(_atomTernjsPackageConfig);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

'use babel';

var checkpointsDefinition = [];

var tags = {

  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;'
};

var accessKey = 'altKey';

exports.accessKey = accessKey;

function focusEditor() {

  var editor = atom.workspace.getActiveTextEditor();

  if (!editor) {

    return;
  }

  var view = atom.views.getView(editor);

  view && view.focus && view.focus();
}

function replaceTag(tag) {

  return tags[tag];
}

function replaceTags(str) {

  if (!str) {

    return '';
  }

  return str.replace(/[&<>]/g, replaceTag);
}

function formatType(data) {

  if (!data.type) {

    return '';
  }

  data.type = data.type.replace(/->/g, ':').replace('<top>', 'window');

  if (!data.exprName) {

    return data.type;
  }

  data.type = data.type.replace(/^fn/, data.exprName);

  return data.type;
}

function prepareType(data) {

  if (!data.type) {

    return;
  }

  return data.type.replace(/->/g, ':').replace('<top>', 'window');
}

function prepareInlineDocs(data) {

  return data.replace(/@param/, '<span class="doc-param-first">@param</span>').replace(/@param/g, '<span class="storage type doc-param">@param</span>').replace(/@return/, '<span class="storage type doc-return">@return</span>');
}

function buildDisplayText(params, name) {

  if (params.length === 0) {

    return name + '()';
  }

  var suggestionParams = params.map(function (param) {

    param = param.replace('}', '\\}');
    param = param.replace(/'"/g, '');

    return param;
  });

  return name + '(' + suggestionParams.join(',') + ')';
}

function buildSnippet(params, name) {

  if (params.length === 0) {

    return name + '()';
  }

  var suggestionParams = params.map(function (param, i) {

    param = param.replace('}', '\\}');

    return '${' + (i + 1) + ':' + param + '}';
  });

  return name + '(' + suggestionParams.join(',') + ')';
}

function extractParams(type) {

  if (!type) {

    return [];
  }

  var start = type.indexOf('(') + 1;
  var params = [];
  var inside = 0;

  for (var i = start; i < type.length; i++) {

    if (type[i] === ':' && inside === -1) {

      params.push(type.substring(start, i - 2));

      break;
    }

    if (i === type.length - 1) {

      var param = type.substring(start, i);

      if (param.length) {

        params.push(param);
      }

      break;
    }

    if (type[i] === ',' && inside === 0) {

      params.push(type.substring(start, i));
      start = i + 1;

      continue;
    }

    if (type[i].match(/[{\[\(]/)) {

      inside++;

      continue;
    }

    if (type[i].match(/[}\]\)]/)) {

      inside--;
    }
  }

  return params;
}

function formatTypeCompletion(obj, isProperty, isObjectKey, isInFunDef) {

  if (obj.isKeyword) {

    obj._typeSelf = 'keyword';
  }

  if (obj.type === 'string') {

    obj.name = obj.name ? obj.name.replace(/(^"|"$)/g, '') : null;
  } else {

    obj.name = obj.name ? obj.name.replace(/["']/g, '') : null;
    obj.name = obj.name ? obj.name.replace(/^..\//, '') : null;
  }

  if (!obj.type) {

    return obj;
  }

  if (!obj.type.startsWith('fn')) {

    if (isProperty) {

      obj._typeSelf = 'property';
    } else {

      obj._typeSelf = 'variable';
    }
  }

  obj.type = obj.rightLabel = prepareType(obj);

  if (obj.type.replace(/fn\(.+\)/, '').length === 0) {

    obj.leftLabel = '';
  } else {

    if (obj.type.indexOf('fn') === -1) {

      obj.leftLabel = obj.type;
    } else {

      obj.leftLabel = obj.type.replace(/fn\(.{0,}\)/, '').replace(' : ', '');
    }
  }

  if (obj.rightLabel.startsWith('fn')) {

    var params = extractParams(obj.rightLabel);

    if (_atomTernjsPackageConfig2['default'].options.useSnippets || _atomTernjsPackageConfig2['default'].options.useSnippetsAndFunction) {

      if (!isInFunDef) {

        obj._snippet = buildSnippet(params, obj.name);
      }

      obj._hasParams = params.length ? true : false;
    } else {

      if (!isInFunDef) {

        obj._snippet = params.length ? obj.name + '(${' + 0 + ':${}})' : obj.name + '()';
      }

      obj._displayText = buildDisplayText(params, obj.name);
    }

    obj._typeSelf = 'function';
  }

  if (obj.name) {

    if (obj.leftLabel === obj.name) {

      obj.leftLabel = null;
      obj.rightLabel = null;
    }
  }

  if (obj.leftLabel === obj.rightLabel) {

    obj.rightLabel = null;
  }

  return obj;
}

function disposeAll(disposables) {

  for (var disposable of disposables) {

    if (!disposable) {

      continue;
    }

    disposable.dispose();
  }
}

function openFileAndGoToPosition(position, file) {

  atom.workspace.open(file).then(function (textEditor) {

    var cursor = textEditor.getLastCursor();

    if (!cursor) {

      return;
    }

    cursor.setBufferPosition(position);
  });
}

function openFileAndGoTo(start, file) {

  atom.workspace.open(file).then(function (textEditor) {

    var buffer = textEditor.getBuffer();
    var cursor = textEditor.getLastCursor();

    if (!buffer || !cursor) {

      return;
    }

    cursor.setBufferPosition(buffer.positionForCharacterIndex(start));
    markDefinitionBufferRange(cursor, textEditor);
  });
}

function updateTernFile(content, restartServer) {

  var projectRoot = _atomTernjsManager2['default'].server && _atomTernjsManager2['default'].server.projectDir;

  if (!projectRoot) {

    return;
  }

  writeFile(_path2['default'].resolve(__dirname, projectRoot + '/.tern-project'), content, restartServer);
}

function writeFile(filePath, content, restartServer) {

  _fs2['default'].writeFile(filePath, content, function (error) {

    atom.workspace.open(filePath);

    if (!error && restartServer) {

      _atomTernjsManager2['default'].restartServer();
    }

    if (!error) {

      return;
    }

    var message = 'Could not create/update .tern-project file. Use the README to manually create a .tern-project file.';

    atom.notifications.addInfo(message, {

      dismissable: true
    });
  });
}

function isDirectory(dir) {

  try {

    return _fs2['default'].statSync(dir).isDirectory();
  } catch (error) {

    return false;
  }
}

function fileExists(path) {

  try {

    _fs2['default'].accessSync(path, _fs2['default'].F_OK, function (error) {

      console.error(error);
    });
  } catch (error) {

    return false;
  }
}

function getFileContent(filePath, root) {

  var _filePath = root + filePath;
  var resolvedPath = _path2['default'].resolve(__dirname, _filePath);

  if (fileExists(resolvedPath) !== undefined) {

    return false;
  }

  return readFile(resolvedPath);
}

function readFile(path) {

  return _fs2['default'].readFileSync(path, 'utf8');
}

function setMarkerCheckpoint() {

  var editor = atom.workspace.getActiveTextEditor();
  var buffer = editor.getBuffer();
  var cursor = editor.getLastCursor();

  if (!cursor) {

    return;
  }

  var marker = buffer.markPosition(cursor.getBufferPosition(), {});

  checkpointsDefinition.push({

    marker: marker,
    editor: editor
  });
}

function markerCheckpointBack() {

  if (!checkpointsDefinition.length) {

    return;
  }

  var checkpoint = checkpointsDefinition.pop();

  openFileAndGoToPosition(checkpoint.marker.getRange().start, checkpoint.editor.getURI());
}

function markDefinitionBufferRange(cursor, editor) {

  var range = cursor.getCurrentWordBufferRange();
  var marker = editor.markBufferRange(range, { invalidate: 'touch' });

  var decoration = editor.decorateMarker(marker, {

    type: 'highlight',
    'class': 'atom-ternjs-definition-marker',
    invalidate: 'touch'
  });

  if (!decoration) {

    return;
  }

  setTimeout(function () {

    decoration.setProperties({

      type: 'highlight',
      'class': 'atom-ternjs-definition-marker active',
      invalidate: 'touch'
    });
  }, 1);

  setTimeout(function () {

    decoration.setProperties({

      type: 'highlight',
      'class': 'atom-ternjs-definition-marker',
      invalidate: 'touch'
    });
  }, 1501);

  setTimeout(function () {

    marker.destroy();
  }, 2500);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9SYWQvLmF0b20vcGFja2FnZXMvYXRvbS10ZXJuanMvbGliL2F0b20tdGVybmpzLWhlbHBlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2lDQUVvQix1QkFBdUI7Ozs7dUNBQ2pCLDhCQUE4Qjs7OztvQkFDdkMsTUFBTTs7OztrQkFDUixJQUFJOzs7O0FBTG5CLFdBQVcsQ0FBQzs7QUFPWixJQUFJLHFCQUFxQixHQUFHLEVBQUUsQ0FBQzs7QUFFL0IsSUFBTSxJQUFJLEdBQUc7O0FBRVgsS0FBRyxFQUFFLE9BQU87QUFDWixLQUFHLEVBQUUsTUFBTTtBQUNYLEtBQUcsRUFBRSxNQUFNO0NBQ1osQ0FBQzs7QUFFSyxJQUFNLFNBQVMsR0FBRyxRQUFRLENBQUM7Ozs7QUFFM0IsU0FBUyxXQUFXLEdBQUc7O0FBRTVCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLEVBQUUsQ0FBQzs7QUFFcEQsTUFBSSxDQUFDLE1BQU0sRUFBRTs7QUFFWCxXQUFPO0dBQ1I7O0FBRUQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXhDLE1BQUksSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztDQUNwQzs7QUFFTSxTQUFTLFVBQVUsQ0FBQyxHQUFHLEVBQUU7O0FBRTlCLFNBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ2xCOztBQUVNLFNBQVMsV0FBVyxDQUFDLEdBQUcsRUFBRTs7QUFFL0IsTUFBSSxDQUFDLEdBQUcsRUFBRTs7QUFFUixXQUFPLEVBQUUsQ0FBQztHQUNYOztBQUVELFNBQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUM7Q0FDMUM7O0FBRU0sU0FBUyxVQUFVLENBQUMsSUFBSSxFQUFFOztBQUUvQixNQUFJ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RWYsY0FBVSxDQUFDLGFBQWEsQ0FBQzs7QUFFdkIsVUFBSSxFQUFFLFdBQVc7QUFDakIsZUFBTywrQkFBK0I7QUFDdEMsZ0JBQVUsRUFBRSxPQUFPO0tBQ3BCLENBQUMsQ0FBQztHQUVKLEVBQUUsSUFBSSxDQUFDLENBQUM7O0FBRVQsWUFBVSxDQUFDLFlBQU07O0FBRWYsVUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0dBRWxCLEVBQUUsSUFBSSxDQUFDLENBQUM7Q0FDViIsImZpbGUiOiIvVXNlcnMvUmFkLy5hdG9tL3BhY2thZ2VzL2F0b20tdGVybmpzL2xpYi9hdG9tLXRlcm5qcy1oZWxwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcblxuaW1wb3J0IG1hbmFnZXIgZnJvbSAnLi9hdG9tLXRlcm5qcy1tYW5hZ2VyJztcbmltcG9ydCBwYWNrYWdlQ29uZmlnIGZyb20gJy4vYXRvbS10ZXJuanMtcGFja2FnZS1jb25maWcnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG5sZXQgY2hlY2twb2ludHNEZWZpbml0aW9uID0gW107XG5cbmNvbnN0IHRhZ3MgPSB7XG5cbiAgJyYnOiAnJmFtcDsnLFxuICAnPCc6ICcmbHQ7JyxcbiAgJz4nOiAnJmd0Oydcbn07XG5cbmV4cG9ydCBjb25zdCBhY2Nlc3NLZXkgPSAnYWx0S2V5JztcblxuZXhwb3J0IGZ1bmN0aW9uIGZvY3VzRWRpdG9yKCkge1xuXG4gIGNvbnN0IGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKTtcblxuICBpZiAoIWVkaXRvcikge1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdmlldyA9IGF0b20udmlld3MuZ2V0VmlldyhlZGl0b3IpO1xuXG4gIHZpZXcgJiYgdmlldy5mb2N1cyAmJiB2aWV3LmZvY3VzKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlVGFnKHRhZykge1xuXG4gIHJldHVybiB0YWdzW3RhZ107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlVGFncyhzdHIpIHtcblxuICBpZiAoIXN0cikge1xuXG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bJjw+XS9nLCByZXBsYWNlVGFnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFR5cGUoZGF0YSkge1xuXG4gIGlmICghZGF0YS50eXBlKSB7XG5cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUucmVwbGFjZSgvLT4vZywgJzonKS5yZXBsYWNlKCc8dG9wPicsICd3aW5kb3cnKTtcblxuICBpZiAoIWRhdGEuZXhwck5hbWUpIHtcblxuICAgIHJldHVybiBkYXRhLnR5cGU7XG4gIH1cblxuICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUucmVwbGFjZSgvXmZuLywgZGF0YS5leHByTmFtZSk7XG5cbiAgcmV0dXJuIGRhdGEudHlwZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByZXBhcmVUeXBlKGRhdGEpIHtcblxuICBpZiAoIWRhdGEudHlwZSkge1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmV0dXJuIGRhdGEudHlwZS5yZXBsYWNlKC8tPi9nLCAnOicpLnJlcGxhY2UoJzx0b3A+JywgJ3dpbmRvdycpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZUlubGluZURvY3MoZGF0YSkge1xuXG4gIHJldHVybiBkYXRhXG4gICAgLnJlcGxhY2UoL0BwYXJhbS8sICc8c3BhbiBjbGFzcz1cImRvYy1wYXJhbS1maXJzdFwiPkBwYXJhbTwvc3Bhbj4nKVxuICAgIC5yZXBsYWNlKC9AcGFyYW0vZywgJzxzcGFuIGNsYXNzPVwic3RvcmFnZSB0eXBlIGRvYy1wYXJhbVwiPkBwYXJhbTwvc3Bhbj4nKVxuICAgIC5yZXBsYWNlKC9AcmV0dXJuLywgJzxzcGFuIGNsYXNzPVwic3RvcmFnZSB0eXBlIGRvYy1yZXR1cm5cIj5AcmV0dXJuPC9zcGFuPicpXG4gICAgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGREaXNwbGF5VGV4dChwYXJhbXMsIG5hbWUpIHtcblxuICBpZiAocGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgcmV0dXJuIGAke25hbWV9KClgO1xuICB9XG5cbiAgbGV0IHN1Z2dlc3Rpb25QYXJhbXMgPSBwYXJhbXMubWFwKChwYXJhbSkgPT4ge1xuXG4gICAgcGFyYW0gPSBwYXJhbS5yZXBsYWNlKCd9JywgJ1xcXFx9Jyk7XG4gICAgcGFyYW0gPSBwYXJhbS5yZXBsYWNlKC8nXCIvZywgJycpO1xuXG4gICAgcmV0dXJuIHBhcmFtO1xuICB9KTtcblxuICByZXR1cm4gYCR7bmFtZX0oJHtzdWdnZXN0aW9uUGFyYW1zLmpvaW4oJywnKX0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkU25pcHBldChwYXJhbXMsIG5hbWUpIHtcblxuICBpZiAocGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgcmV0dXJuIGAke25hbWV9KClgO1xuICB9XG5cbiAgbGV0IHN1Z2dlc3Rpb25QYXJhbXMgPSBwYXJhbXMubWFwKChwYXJhbSwgaSkgPT4ge1xuXG4gICAgcGFyYW0gPSBwYXJhbS5yZXBsYWNlKCd9JywgJ1xcXFx9Jyk7XG5cbiAgICByZXR1cm4gYFxcJHske2kgKyAxfToke3BhcmFtfX1gO1xuICB9KTtcblxuICByZXR1cm4gYCR7bmFtZX0oJHtzdWdnZXN0aW9uUGFyYW1zLmpvaW4oJywnKX0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RQYXJhbXModHlwZSkge1xuXG4gIGlmICghdHlwZSkge1xuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgbGV0IHN0YXJ0ID0gdHlwZS5pbmRleE9mKCcoJykgKyAxO1xuICBsZXQgcGFyYW1zID0gW107XG4gIGxldCBpbnNpZGUgPSAwO1xuXG4gIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHR5cGUubGVuZ3RoOyBpKyspIHtcblxuICAgIGlmICh0eXBlW2ldID09PSAnOicgJiYgaW5zaWRlID09PSAtMSkge1xuXG4gICAgICBwYXJhbXMucHVzaCh0eXBlLnN1YnN0cmluZyhzdGFydCwgaSAtIDIpKTtcblxuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKGkgPT09IHR5cGUubGVuZ3RoIC0gMSkge1xuXG4gICAgICBjb25zdCBwYXJhbSA9IHR5cGUuc3Vic3RyaW5nKHN0YXJ0LCBpKTtcblxuICAgICAgaWYgKHBhcmFtLmxlbmd0aCkge1xuXG4gICAgICAgIHBhcmFtcy5wdXNoKHBhcmFtKTtcbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVbaV0gPT09ICcsJyAmJiBpbnNpZGUgPT09IDApIHtcblxuICAgICAgcGFyYW1zLnB1c2godHlwZS5zdWJzdHJpbmcoc3RhcnQsIGkpKTtcbiAgICAgIHN0YXJ0ID0gaSArIDE7XG5cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlW2ldLm1hdGNoKC9be1xcW1xcKF0vKSkge1xuXG4gICAgICBpbnNpZGUrKztcblxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVbaV0ubWF0Y2goL1t9XFxdXFwpXS8pKSB7XG5cbiAgICAgIGluc2lkZS0tO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYXJhbXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRUeXBlQ29tcGxldGlvbihvYmosIGlzUHJvcGVydHksIGlzT2JqZWN0S2V5LCBpc0luRnVuRGVmKSB7XG5cbiAgaWYgKG9iai5pc0tleXdvcmQpIHtcblxuICAgIG9iai5fdHlwZVNlbGYgPSAna2V5d29yZCc7XG4gIH1cblxuICBpZiAob2JqLnR5cGUgPT09ICdzdHJpbmcnKSB7XG5cbiAgICBvYmoubmFtZSA9IG9iai5uYW1lID8gb2JqLm5hbWUucmVwbGFjZSgvKF5cInxcIiQpL2csICcnKSA6IG51bGw7XG5cbiAgfSBlbHNlIHtcblxuICAgIG9iai5uYW1lID0gb2JqLm5hbWUgPyBvYmoubmFtZS5yZXBsYWNlKC9bXCInXS9nLCAnJykgOiBudWxsO1xuICAgIG9iai5uYW1lID0gb2JqLm5hbWUgPyBvYmoubmFtZS5yZXBsYWNlKC9eLi5cXC8vLCAnJykgOiBudWxsO1xuICB9XG5cbiAgaWYgKCFvYmoudHlwZSkge1xuXG4gICAgcmV0dXJuIG9iajtcbiAgfVxuXG4gIGlmICghb2JqLnR5cGUuc3RhcnRzV2l0aCgnZm4nKSkge1xuXG4gICAgaWYgKGlzUHJvcGVydHkpIHtcblxuICAgICAgb2JqLl90eXBlU2VsZiA9ICdwcm9wZXJ0eSc7XG5cbiAgICB9IGVsc2Uge1xuXG4gICAgICBvYmouX3R5cGVTZWxmID0gJ3ZhcmlhYmxlJztcbiAgICB9XG4gIH1cblxuICBvYmoudHlwZSA9IG9iai5yaWdodExhYmVsID0gcHJlcGFyZVR5cGUob2JqKTtcblxuICBpZiAob2JqLnR5cGUucmVwbGFjZSgvZm5cXCguK1xcKS8sICcnKS5sZW5ndGggPT09IDApIHtcblxuICAgIG9iai5sZWZ0TGFiZWwgPSAnJztcblxuICB9IGVsc2Uge1xuXG4gICAgaWYgKG9iai50eXBlLmluZGV4T2YoJ2ZuJykgPT09IC0xKSB7XG5cbiAgICAgIG9iai5sZWZ0TGFiZWwgPSBvYmoudHlwZTtcblxuICAgIH0gZWxzZSB7XG5cbiAgICAgIG9iai5sZWZ0TGFiZWwgPSBvYmoudHlwZS5yZXBsYWNlKC9mblxcKC57MCx9XFwpLywgJycpLnJlcGxhY2UoJyA6ICcsICcnKTtcbiAgICB9XG4gIH1cblxuICBpZiAob2JqLnJpZ2h0TGFiZWwuc3RhcnRzV2l0aCgnZm4nKSkge1xuXG4gICAgbGV0IHBhcmFtcyA9IGV4dHJhY3RQYXJhbXMob2JqLnJpZ2h0TGFiZWwpO1xuXG4gICAgaWYgKFxuICAgICAgcGFja2FnZUNvbmZpZy5vcHRpb25zLnVzZVNuaXBwZXRzIHx8XG4gICAgICBwYWNrYWdlQ29uZmlnLm9wdGlvbnMudXNlU25pcHBldHNBbmRGdW5jdGlvblxuICAgICkge1xuXG4gICAgICBpZiAoIWlzSW5GdW5EZWYpIHtcblxuICAgICAgICBvYmouX3NuaXBwZXQgPSBidWlsZFNuaXBwZXQocGFyYW1zLCBvYmoubmFtZSk7XG4gICAgICB9XG5cbiAgICAgIG9iai5faGFzUGFyYW1zID0gcGFyYW1zLmxlbmd0aCA/IHRydWUgOiBmYWxzZTtcblxuICAgIH0gZWxzZSB7XG5cbiAgICAgIGlmICghaXNJbkZ1bkRlZikge1xuXG4gICAgICAgIG9iai5fc25pcHBldCA9IHBhcmFtcy5sZW5ndGggPyBgJHtvYmoubmFtZX0oXFwkeyR7MH06XFwke319KWAgOiBgJHtvYmoubmFtZX0oKWA7XG4gICAgICB9XG5cbiAgICAgIG9iai5fZGlzcGxheVRleHQgPSBidWlsZERpc3BsYXlUZXh0KHBhcmFtcywgb2JqLm5hbWUpO1xuICAgIH1cblxuICAgIG9iai5fdHlwZVNlbGYgPSAnZnVuY3Rpb24nO1xuICB9XG5cbiAgaWYgKG9iai5uYW1lKSB7XG5cbiAgICBpZiAob2JqLmxlZnRMYWJlbCA9PT0gb2JqLm5hbWUpIHtcblxuICAgICAgb2JqLmxlZnRMYWJlbCA9IG51bGw7XG4gICAgICBvYmoucmlnaHRMYWJlbCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgaWYgKG9iai5sZWZ0TGFiZWwgPT09IG9iai5yaWdodExhYmVsKSB7XG5cbiAgICBvYmoucmlnaHRMYWJlbCA9IG51bGw7XG4gIH1cblxuICByZXR1cm4gb2JqO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGlzcG9zZUFsbChkaXNwb3NhYmxlcykge1xuXG4gIGZvciAoY29uc3QgZGlzcG9zYWJsZSBvZiBkaXNwb3NhYmxlcykge1xuXG4gICAgaWYgKCFkaXNwb3NhYmxlKSB7XG5cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuRmlsZUFuZEdvVG9Qb3NpdGlvbihwb3NpdGlvbiwgZmlsZSkge1xuXG4gIGF0b20ud29ya3NwYWNlLm9wZW4oZmlsZSkudGhlbigodGV4dEVkaXRvcikgPT4ge1xuXG4gICAgY29uc3QgY3Vyc29yID0gdGV4dEVkaXRvci5nZXRMYXN0Q3Vyc29yKCk7XG5cbiAgICBpZiAoIWN1cnNvcikge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY3Vyc29yLnNldEJ1ZmZlclBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuRmlsZUFuZEdvVG8oc3RhcnQsIGZpbGUpIHtcblxuICBhdG9tLndvcmtzcGFjZS5vcGVuKGZpbGUpLnRoZW4oKHRleHRFZGl0b3IpID0+IHtcblxuICAgIGNvbnN0IGJ1ZmZlciA9IHRleHRFZGl0b3IuZ2V0QnVmZmVyKCk7XG4gICAgY29uc3QgY3Vyc29yID0gdGV4dEVkaXRvci5nZXRMYXN0Q3Vyc29yKCk7XG5cbiAgICBpZiAoXG4gICAgICAhYnVmZmVyIHx8XG4gICAgICAhY3Vyc29yXG4gICAgKSB7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjdXJzb3Iuc2V0QnVmZmVyUG9zaXRpb24oYnVmZmVyLnBvc2l0aW9uRm9yQ2hhcmFjdGVySW5kZXgoc3RhcnQpKTtcbiAgICBtYXJrRGVmaW5pdGlvbkJ1ZmZlclJhbmdlKGN1cnNvciwgdGV4dEVkaXRvcik7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlVGVybkZpbGUoY29udGVudCwgcmVzdGFydFNlcnZlcikge1xuXG4gIGNvbnN0IHByb2plY3RSb290ID0gbWFuYWdlci5zZXJ2ZXIgJiYgbWFuYWdlci5zZXJ2ZXIucHJvamVjdERpcjtcblxuICBpZiAoIXByb2plY3RSb290KSB7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICB3cml0ZUZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgcHJvamVjdFJvb3QgKyAnLy50ZXJuLXByb2plY3QnKSwgY29udGVudCwgcmVzdGFydFNlcnZlcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZUZpbGUoZmlsZVBhdGgsIGNvbnRlbnQsIHJlc3RhcnRTZXJ2ZXIpIHtcblxuICBmcy53cml0ZUZpbGUoZmlsZVBhdGgsIGNvbnRlbnQsIChlcnJvcikgPT4ge1xuXG4gICAgYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlUGF0aCk7XG5cbiAgICBpZiAoIWVycm9yICYmIHJlc3RhcnRTZXJ2ZXIpIHtcblxuICAgICAgbWFuYWdlci5yZXN0YXJ0U2VydmVyKCk7XG4gICAgfVxuXG4gICAgaWYgKCFlcnJvcikge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZSA9ICdDb3VsZCBub3QgY3JlYXRlL3VwZGF0ZSAudGVybi1wcm9qZWN0IGZpbGUuIFVzZSB0aGUgUkVBRE1FIHRvIG1hbnVhbGx5IGNyZWF0ZSBhIC50ZXJuLXByb2plY3QgZmlsZS4nO1xuXG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEluZm8obWVzc2FnZSwge1xuXG4gICAgICBkaXNtaXNzYWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRGlyZWN0b3J5KGRpcikge1xuXG4gIHRyeSB7XG5cbiAgICByZXR1cm4gZnMuc3RhdFN5bmMoZGlyKS5pc0RpcmVjdG9yeSgpO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbGVFeGlzdHMocGF0aCkge1xuXG4gIHRyeSB7XG5cbiAgICBmcy5hY2Nlc3NTeW5jKHBhdGgsIGZzLkZfT0ssIChlcnJvcikgPT4ge1xuXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlQ29udGVudChmaWxlUGF0aCwgcm9vdCkge1xuXG4gIGNvbnN0IF9maWxlUGF0aCA9IHJvb3QgKyBmaWxlUGF0aDtcbiAgY29uc3QgcmVzb2x2ZWRQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgX2ZpbGVQYXRoKTtcblxuICBpZiAoZmlsZUV4aXN0cyhyZXNvbHZlZFBhdGgpICE9PSB1bmRlZmluZWQpIHtcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiByZWFkRmlsZShyZXNvbHZlZFBhdGgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEZpbGUocGF0aCkge1xuXG4gIHJldHVybiBmcy5yZWFkRmlsZVN5bmMocGF0aCwgJ3V0ZjgnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1hcmtlckNoZWNrcG9pbnQoKSB7XG5cbiAgY29uc3QgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpO1xuICBjb25zdCBidWZmZXIgPSBlZGl0b3IuZ2V0QnVmZmVyKCk7XG4gIGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRMYXN0Q3Vyc29yKCk7XG5cbiAgaWYgKCFjdXJzb3IpIHtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1hcmtlciA9IGJ1ZmZlci5tYXJrUG9zaXRpb24oY3Vyc29yLmdldEJ1ZmZlclBvc2l0aW9uKCksIHt9KTtcblxuICBjaGVja3BvaW50c0RlZmluaXRpb24ucHVzaCh7XG5cbiAgICBtYXJrZXI6IG1hcmtlcixcbiAgICBlZGl0b3I6IGVkaXRvclxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1hcmtlckNoZWNrcG9pbnRCYWNrKCkge1xuXG4gIGlmICghY2hlY2twb2ludHNEZWZpbml0aW9uLmxlbmd0aCkge1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY2hlY2twb2ludCA9IGNoZWNrcG9pbnRzRGVmaW5pdGlvbi5wb3AoKTtcblxuICBvcGVuRmlsZUFuZEdvVG9Qb3NpdGlvbihjaGVja3BvaW50Lm1hcmtlci5nZXRSYW5nZSgpLnN0YXJ0LCBjaGVja3BvaW50LmVkaXRvci5nZXRVUkkoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXJrRGVmaW5pdGlvbkJ1ZmZlclJhbmdlKGN1cnNvciwgZWRpdG9yKSB7XG5cbiAgY29uc3QgcmFuZ2UgPSBjdXJzb3IuZ2V0Q3VycmVudFdvcmRCdWZmZXJSYW5nZSgpO1xuICBjb25zdCBtYXJrZXIgPSBlZGl0b3IubWFya0J1ZmZlclJhbmdlKHJhbmdlLCB7aW52YWxpZGF0ZTogJ3RvdWNoJ30pO1xuXG4gIGNvbnN0IGRlY29yYXRpb24gPSBlZGl0b3IuZGVjb3JhdGVNYXJrZXIobWFya2VyLCB7XG5cbiAgICB0eXBlOiAnaGlnaGxpZ2h0JyxcbiAgICBjbGFzczogJ2F0b20tdGVybmpzLWRlZmluaXRpb24tbWFya2VyJyxcbiAgICBpbnZhbGlkYXRlOiAndG91Y2gnXG4gIH0pO1xuXG4gIGlmICghZGVjb3JhdGlvbikge1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgc2V0VGltZW91dCgoKSA9PiB7XG5cbiAgICBkZWNvcmF0aW9uLnNldFByb3BlcnRpZXMoe1xuXG4gICAgICB0eXBlOiAnaGlnaGxpZ2h0JyxcbiAgICAgIGNsYXNzOiAnYXRvbS10ZXJuanMtZGVmaW5pdGlvbi1tYXJrZXIgYWN0aXZlJyxcbiAgICAgIGludmFsaWRhdGU6ICd0b3VjaCdcbiAgICB9KTtcblxuICB9LCAxKTtcblxuICBzZXRUaW1lb3V0KCgpID0+IHtcblxuICAgIGRlY29yYXRpb24uc2V0UHJvcGVydGllcyh7XG5cbiAgICAgIHR5cGU6ICdoaWdobGlnaHQnLFxuICAgICAgY2xhc3M6ICdhdG9tLXRlcm5qcy1kZWZpbml0aW9uLW1hcmtlcicsXG4gICAgICBpbnZhbGlkYXRlOiAndG91Y2gnXG4gICAgfSk7XG5cbiAgfSwgMTUwMSk7XG5cbiAgc2V0VGltZW91dCgoKSA9PiB7XG5cbiAgICBtYXJrZXIuZGVzdHJveSgpO1xuXG4gIH0sIDI1MDApO1xufVxuIl19
//# sourceURL=/Users/Rad/.atom/packages/atom-ternjs/lib/atom-ternjs-helper.js
